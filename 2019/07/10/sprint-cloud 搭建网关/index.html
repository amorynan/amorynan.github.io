<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>springcloud æ­å»ºç½‘å…³å±‚ | WelCome to amory's world!</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="icon" href="/favicon.ico"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#springcloud-æ­å»ºç½‘å…³å±‚"><span class="toc-number">1.</span> <span class="toc-text"> springcloud æ­å»ºç½‘å…³å±‚</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1561376322195&amp;di=968ecdc60b194dac7a024a8e75182703&amp;imgtype=0&amp;src=http%3A%2F%2Fgss0.baidu.com%2F94o3dSag_xI4khGko9WTAnF6hhy%2Fzhidao%2Fpic%2Fitem%2F91529822720e0cf397cc85d40846f21fbe09aae2.jpg"></div><div class="author-info__name text-center">amory wang</div><div class="author-info__description text-center">hey ...</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container" style="background-image: url(true)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">WelCome to amory's world!</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">springcloud æ­å»ºç½‘å…³å±‚</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-10 </time></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><hr>
<h2 id="springcloud-æ­å»ºç½‘å…³å±‚"><a href="#springcloud-æ­å»ºç½‘å…³å±‚" class="headerlink" title=" springcloud æ­å»ºç½‘å…³å±‚"></a> springcloud æ­å»ºç½‘å…³å±‚</h2><pre><code>å‰è¨€ï¼šæœ€è¿‘æ¥äº†ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œæ˜¯ä¸ºå…¬å¸æ­å»ºä¸€ä¸ªç½‘å…³å±‚ï¼Œä¸¤ä¸ªä½œç”¨ï¼Œä¸€ä¸ªæ˜¯å°†éœ€è¦ç¬¬ä¸‰æ–¹è¯·æ±‚çš„æ¥å£
å°è£…èµ·æ¥ï¼Œä½œä¸ºä¸€ä¸ªç½‘å…³ï¼Œä¸€ä¸ªæ˜¯å°†è‡ªå·±å…¬å¸å„ç§æœåŠ¡çš„api å¯æš´éœ²çš„æ”¾åˆ°å®¢æˆ·ç«¯ç½‘å…³å±‚ï¼Œä¾›å¤–é¢æœ
åŠ¡çš„ä½¿ç”¨ï¼Œè€Œé‡Œé¢çš„æœåŠ¡åˆ™æ˜¯è¢«åŒ…è£¹èµ·æ¥ï¼Œæƒ³è¦è¾¾åˆ°å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ„Ÿè§‰    </code></pre><p><img src="https://github.com/amorynan/study/blob/master/pic/my.png?raw=true" alt></p>
<p>ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹ï¼Œè¿™ä¸å°±æ˜¯æƒ³åšä¸€ä¸ªä¸­é—´ä»¶å£å’å˜›ï¼Œç„¶ååˆæŸ¥äº†åŠå¤©çš„èµ„æ–™ï¼Œæœ€ç»ˆå†³å®šé‡‡ç”¨spring-cloud çš„eureka æ¥åšæœåŠ¡çš„provider å’Œ consumer çš„æ’ä»¶ï¼Œokï¼Œ è¯ä¸å¤šè¯´ï¼Œå› ä¸ºåƒè¿™ç§æŠ€æœ¯é€‰å‹ç±»å‹çš„æ´»å„¿ä¹Ÿæ²¡æœ‰å¾ˆå¤šå¯ä»¥è®²çš„ï¼Œä¸»è¦è¿˜æ˜¯çœ‹æºç æ¯”è¯´çš„æ¥çš„é€å½»ï¼Œä¸‹é¢å°±å¼€å§‹ä¸Šçˆªå®ç°äº†</p>
<p>####first. æ„å»ºä¸‰ä¸ªæœåŠ¡ï¼Œ client-serverï¼Œ third-serverï¼Œ and mini-serverï¼ˆå……å½“å†…éƒ¨æœåŠ¡è§’è‰²ï¼‰<br>    è§’è‰²æ‰®æ¼”<br>    client-serverï¼šç»™å¤–éƒ¨æœåŠ¡çš„æ¥å£ç½‘å…³å±‚<br>    third-serverï¼šå°è£…éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡æ¥å£ç½‘å…³å±‚<br>    mini-serverï¼šå……å½“è‡ªå·±å†…éƒ¨æœåŠ¡çš„è§’è‰²</p>
<p>å…³äºclient-serverï¼šæˆ‘çš„é¢„æœŸæ˜¯è¦åšåˆ°ï¼Œå†…éƒ¨æœåŠ¡æˆ–è€…ä¸€ä¸ªé¡¹ç›®çš„æ–°å»ºï¼Œå¯ä»¥åœ¨ç½‘å…³å±‚å‘ç°ï¼Œå¹¶ä¸”åœ¨æŒç»­æ·»åŠ å’Œç»´æŠ¤api+controller å°±å¯ä»¥è°ƒç”¨å†…éƒ¨çš„é¡¹ç›®çš„apiè¿›è¡Œæ“ä½œäº†ã€‚</p>
<p>å…³äºthird-serverï¼š æˆ‘çš„é¢„æœŸæ˜¯è¦åšåˆ°ï¼ŒæŠŠæ‰€æœ‰éœ€è¦ä¸‰æ–¹æœåŠ¡çš„æ¥å£å…¨éƒ¨å°è£…åˆ°apiï¼Œç„¶åå†…éƒ¨æœåŠ¡å‘ç°å¹¶ä¸”åšåˆ°å¯è°ƒç”¨æ­¤apiä¾¿èƒ½è®¿é—®ä¸‰æ–¹æœåŠ¡ï¼Œæ¯”å¦‚aliyunçš„oss æˆ–è€… sms ç­‰</p>
<p>å…³äºmini-server ï¼š å¯è‡ªç”±å‘æŒ¥ï¼Œç”µå•†ç³»ç»Ÿorå°ç¨‹åºéƒ½å¯</p>
<p>####second. third-server begain<br>ä» third-serverå¼€å§‹ï¼Œæ­¤æœåŠ¡ä¸»è¦å°±æ˜¯èƒ½å°è£…å¯¹æ¥ä¸‰æ–¹å¯èƒ½éœ€è¦çš„æœåŠ¡ï¼Œæš‚æ—¶æˆ‘åªå‘ç°æˆ‘ä»¬éœ€è¦oss å’Œ smsï¼Œæ‰€ä»¥å…ˆä»è¿™ä¸¤ä¸ªéœ€æ±‚ç€æ‰‹åš</p>
<p>é‚£ä¹ˆç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¥å£ï¼ˆæˆ‘æ–°å»ºæœåŠ¡ä¸€èˆ¬éƒ½æ˜¯å…ˆå®šä¹‰å¥½æ¥å£ï¼Œä¹Ÿå°±æ˜¯æƒ³å¥½æ–¹æ³•çš„å…¥å‚å’Œå‡ºå‚ï¼Œç„¶åå†è€ƒè™‘å…·ä½“çš„å®ç°ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class ApiConstants &#123;</span><br><span class="line">    //aliyun oss</span><br><span class="line">    private final static String ALI_YUN = &quot;/aliyun&quot;;</span><br><span class="line">    public final static String OSS = ALI_YUN + &quot;/oss&quot;;</span><br><span class="line">    public final static String POLICY = &quot;/policy&quot;;</span><br><span class="line">    public final static String CALLBACK = &quot;/callback&quot;;</span><br><span class="line"></span><br><span class="line">    //aliyun sms</span><br><span class="line">    public final static String SMS = ALI_YUN + &quot;/sms&quot;;</span><br><span class="line">    public final static String SEND_CODE = &quot;/sendCode&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯ç¬¬äºŒæ­¥ï¼Œcontroller &amp; service</p>
<p>2.1 oss yml &amp; å®ç°åŸç†ï¼ˆæœåŠ¡ç«¯ç­¾ååå‰ç«¯é€šè¿‡è¡¨å•ä¸Šä¼ å¹¶ä¸”é€šè¿‡ä¹‹å‰çš„å›è°ƒè¿›è¡ŒæœåŠ¡ç«¯çš„é€šçŸ¥ï¼‰</p>
<p><img src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/4406/15598059711520_zh-CN.png" alt></p>
<p>å¯¹æ¥aliyun oss ä½ æ‰€éœ€è¦çš„é…ç½®ï¼Œå¯æ”¾åœ¨ä½ çš„yml é‡Œé¢</p>
<pre><code>aliyun:
oss:
endpoint: oss-cn-hangzhou.aliyuncs.com # osså¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸå
accessKeyId: test # è®¿é—®èº«ä»½éªŒè¯ä¸­ç”¨åˆ°ç”¨æˆ·æ ‡è¯†
accessKeySecret: test # ç”¨æˆ·ç”¨äºåŠ å¯†ç­¾åå­—ç¬¦ä¸²å’Œossç”¨æ¥éªŒè¯ç­¾åå­—ç¬¦ä¸²çš„å¯†é’¥
bucketName: macro-oss # ossçš„å­˜å‚¨ç©ºé—´
policy:
  expire: 300 # ç­¾åæœ‰æ•ˆæœŸ(S)
maxSize: 10 # ä¸Šä¼ æ–‡ä»¶å¤§å°(M)
callback: http://:8080/aliyun/oss/callback # æ–‡ä»¶ä¸Šä¼ æˆåŠŸåçš„å›è°ƒåœ°å€
dir:
  prefix: thirdgateway/images/ # ä¸Šä¼ æ–‡ä»¶å¤¹è·¯å¾„å‰ç¼€

ä»¥ä¸Šéœ€è¦åœ¨oss service ä¸­ç”¨åˆ°ï¼Œæ‰€ä»¥å¯ä»¥ç”¨@value å¼•å…¥è¿›æ¥

@Value (&quot;${aliyun.oss.policy.expire}&quot;)
private int ALIYUN_OSS_EXPIRE;
@Value(&quot;${aliyun.oss.maxSize}&quot;)
private int ALIYUN_OSS_MAX_SIZE;
@Value(&quot;${aliyun.oss.callback}&quot;)
private String ALIYUN_OSS_CALLBACK;
@Value(&quot;${aliyun.oss.bucketName}&quot;)
private String ALIYUN_OSS_BUCKET_NAME;
@Value(&quot;${aliyun.oss.endpoint}&quot;)
private String ALIYUN_OSS_ENDPOINT;
@Value(&quot;${aliyun.oss.dir.prefix}&quot;)
private String ALIYUN_OSS_DIR_PREFIX;</code></pre><p>2.2 ossClient &amp; ossConfig</p>
<p>éœ€è¦é€šè¿‡ossConfig ç”Ÿæˆä¸€ä¸ªossClient bean å°†aliyunæä¾›çš„ossä¸‰æ–¹åŒ…ä¸­çš„ossClient çš„ç±»å¯¹è±¡å¼•å…¥è¿›æ¥</p>
<p>æ„é€ ä¸€ä¸ªconfigç„¶ååŠ å…¥ossclient bean çš„å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class OssConfig &#123;</span><br><span class="line">        @Value (&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span><br><span class="line">        private String ALIYUN_OSS_ENDPOINT;</span><br><span class="line">        @Value(&quot;$&#123;aliyun.oss.accessKeyId&#125;&quot;)</span><br><span class="line">        private String ALIYUN_OSS_ACCESSKEYID;</span><br><span class="line">        @Value(&quot;$&#123;aliyun.oss.accessKeySecret&#125;&quot;)</span><br><span class="line">        private String ALIYUN_OSS_ACCESSKEYSECRET;</span><br><span class="line">        </span><br><span class="line">        @Bean</span><br><span class="line">        public OSSClient ossClient()&#123;</span><br><span class="line">            return new OSSClient(ALIYUN_OSS_ENDPOINT,ALIYUN_OSS_ACCESSKEYID,ALIYUN_OSS_ACCESSKEYSECRET);</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨oss service ä¸­ç”¨åˆ°è¿™ä¸ªbean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">import cn.hutool.json.JSONUtil;</span><br><span class="line">import com.aliyun.oss.OSSClient;</span><br><span class="line">import com.aliyun.oss.common.utils.BinaryUtil;</span><br><span class="line">import com.aliyun.oss.model.MatchMode;</span><br><span class="line">import com.aliyun.oss.model.PolicyConditions;</span><br><span class="line">import com.cjs.amory.domains.OssCallbackParam;</span><br><span class="line">import com.cjs.amory.domains.OssCallbackResult;</span><br><span class="line">import com.cjs.amory.domains.OssPolicyResult;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author: amory</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">@Slf4j</span><br><span class="line">public class OssService &#123;</span><br><span class="line">    @Value (&quot;$&#123;aliyun.oss.policy.expire&#125;&quot;)</span><br><span class="line">    private int ALIYUN_OSS_EXPIRE;</span><br><span class="line">    @Value(&quot;$&#123;aliyun.oss.maxSize&#125;&quot;)</span><br><span class="line">    private int ALIYUN_OSS_MAX_SIZE;</span><br><span class="line">    @Value(&quot;$&#123;aliyun.oss.callback&#125;&quot;)</span><br><span class="line">    private String ALIYUN_OSS_CALLBACK;</span><br><span class="line">    @Value(&quot;$&#123;aliyun.oss.bucketName&#125;&quot;)</span><br><span class="line">    private String ALIYUN_OSS_BUCKET_NAME;</span><br><span class="line">    @Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span><br><span class="line">    private String ALIYUN_OSS_ENDPOINT;</span><br><span class="line">    @Value(&quot;$&#123;aliyun.oss.dir.prefix&#125;&quot;)</span><br><span class="line">    private String ALIYUN_OSS_DIR_PREFIX;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private OSSClient ossClient;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * ç­¾åç”Ÿæˆ</span><br><span class="line">     */</span><br><span class="line">    public OssPolicyResult policy() &#123;</span><br><span class="line">        OssPolicyResult result = new OssPolicyResult();</span><br><span class="line">        // å­˜å‚¨ç›®å½•</span><br><span class="line">        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span><br><span class="line">        String dir = ALIYUN_OSS_DIR_PREFIX+sdf.format(new Date());</span><br><span class="line">        // ç­¾åæœ‰æ•ˆæœŸ</span><br><span class="line">        long expireEndTime = System.currentTimeMillis() + ALIYUN_OSS_EXPIRE * 1000;</span><br><span class="line">        Date expiration = new Date(expireEndTime);</span><br><span class="line">        // æ–‡ä»¶å¤§å°</span><br><span class="line">        long maxSize = ALIYUN_OSS_MAX_SIZE * 1024 * 1024;</span><br><span class="line">        // å›è°ƒ</span><br><span class="line">        OssCallbackParam callback = new OssCallbackParam();</span><br><span class="line">        callback.setCallbackUrl(ALIYUN_OSS_CALLBACK);</span><br><span class="line">        callback.setCallbackBody(&quot;filename=$&#123;object&#125;&amp;size=$&#123;size&#125;&amp;mimeType=$&#123;mimeType&#125;&amp;height=$&#123;imageInfo.height&#125;&amp;width=$&#123;imageInfo.width&#125;&quot;);</span><br><span class="line">        callback.setCallbackBodyType(&quot;application/x-www-form-urlencoded&quot;);</span><br><span class="line">        // æäº¤èŠ‚ç‚¹</span><br><span class="line">        String action = &quot;http://&quot; + ALIYUN_OSS_BUCKET_NAME + &quot;.&quot; + ALIYUN_OSS_ENDPOINT;</span><br><span class="line">        try &#123;</span><br><span class="line">            PolicyConditions policyConds = new PolicyConditions();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, 0, maxSize);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line">            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            byte[] binaryData = postPolicy.getBytes(&quot;utf-8&quot;);</span><br><span class="line">            String policy = BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            String signature = ossClient.calculatePostSignature(postPolicy);</span><br><span class="line">            String callbackData = BinaryUtil.toBase64String(JSONUtil.parse(callback).toString().getBytes(&quot;utf-8&quot;));</span><br><span class="line">            // è¿”å›ç»“æœ</span><br><span class="line">            result.setAccessKeyId(ossClient.getCredentialsProvider().getCredentials().getAccessKeyId());</span><br><span class="line">            result.setPolicy(policy);</span><br><span class="line">            result.setSignature(signature);</span><br><span class="line">            result.setDir(dir);</span><br><span class="line">            result.setCallback(callbackData);</span><br><span class="line">            result.setHost(action);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;exception&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public OssCallbackResult callback(HttpServletRequest request) &#123;</span><br><span class="line">        OssCallbackResult result= new OssCallbackResult();</span><br><span class="line">        String filename = request.getParameter(&quot;filename&quot;);</span><br><span class="line">        filename = &quot;http://&quot;.concat(ALIYUN_OSS_BUCKET_NAME).concat(&quot;.&quot;).concat(ALIYUN_OSS_ENDPOINT).concat(&quot;/&quot;).concat(filename);</span><br><span class="line">        result.setFilename(filename);</span><br><span class="line">        result.setSize(request.getParameter(&quot;size&quot;));</span><br><span class="line">        result.setMimeType(request.getParameter(&quot;mimeType&quot;));</span><br><span class="line">        result.setWidth(request.getParameter(&quot;width&quot;));</span><br><span class="line">        result.setHeight(request.getParameter(&quot;height&quot;));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨service ä¸­ä¸¤ä¸ªæ ¸å¿ƒçš„æ–¹æ³•å¯¹æ¥oss ä¸‰æ–¹ï¼Œpolicyè¿›è¡Œç­¾åçš„ç”Ÿæˆï¼Œè¿™ä¸ªå°±æ˜¯æ•´åˆä½ åœ¨yml ä¸­æ³¨å†Œçš„accesskey Idä»¥åŠè‡ªå·±çš„ä¿¡æ¯ï¼Œç›®å½•ï¼Œæœ‰æ•ˆæœŸï¼Œå¤§å°ï¼Œä»¥åŠæ•²é»‘æ¿ï¼šoss è¿›è¡Œå›è°ƒçš„æ¥å£ï¼Œ åœ¨è¿™ä¸ªæ¥å£ï¼Œä½ éœ€è¦è‡ªå·±å®ç°ï¼Œä¹Ÿå°±æ˜¯ğŸ‘†ä»£ç ä¸­çš„callback æ–¹æ³•ï¼Œé€šè¿‡controller æ§åˆ¶ï¼Œ å¹¶ä¸”åœ¨policyé‡Œå›è°ƒçš„bodyå’Œtypeä¹Ÿæ˜¯ä½ è‡ªå·±å®šä¹‰å¥½çš„ï¼Œç»Ÿä¸€å°è£…åˆ°OssCallBackParamä¸­ï¼Œç„¶ååœ¨ä½œä¸ºä¸€ä¸ªå¯¹è±¡å°è£…åˆ°OssPolicyResult å¯¹è±¡ä¸­ï¼Œä½œä¸ºç­¾åä¸ossä¸‰æ–¹å¯¹æ¥è¿”å›çš„æ•´ä½“ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class OssPolicyResult &#123;</span><br><span class="line">    @ApiModelProperty (&quot;è®¿é—®èº«ä»½éªŒè¯ä¸­ç”¨åˆ°ç”¨æˆ·æ ‡è¯†&quot;)</span><br><span class="line">    private String accessKeyId;</span><br><span class="line">    @ApiModelProperty(&quot;ç”¨æˆ·è¡¨å•ä¸Šä¼ çš„ç­–ç•¥,ç»è¿‡base64ç¼–ç è¿‡çš„å­—ç¬¦ä¸²&quot;)</span><br><span class="line">    private String policy;</span><br><span class="line">    @ApiModelProperty(&quot;å¯¹policyç­¾ååçš„å­—ç¬¦ä¸²&quot;)</span><br><span class="line">    private String signature;</span><br><span class="line">    @ApiModelProperty(&quot;ä¸Šä¼ æ–‡ä»¶å¤¹è·¯å¾„å‰ç¼€&quot;)</span><br><span class="line">    private String dir;</span><br><span class="line">    @ApiModelProperty(&quot;osså¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸå&quot;)</span><br><span class="line">    private String host;</span><br><span class="line">    @ApiModelProperty(&quot;ä¸Šä¼ æˆåŠŸåçš„å›è°ƒè®¾ç½®&quot;)</span><br><span class="line">    private String callback;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3 callback æ¥å£ ä½œä¸ºservice è¿›è¡Œcallbackçš„é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation(value = &quot;ossä¸Šä¼ æˆåŠŸå›è°ƒ&quot;)</span><br><span class="line">    @RequestMapping(value = ApiConstants.CALLBACK, method = RequestMethod.POST)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public CommonResult&lt;OssCallbackResult&gt; callback(HttpServletRequest request) &#123;</span><br><span class="line">        OssCallbackResult ossCallbackResult = ossService.callback(request);</span><br><span class="line">        return CommonResult.success(ossCallbackResult);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå®¢æˆ·ç«¯å°±å¯é€šè¿‡callbackè·å¾—æ–‡ä»¶æµäº†</p>
<p>2.4 sms æœåŠ¡<br>å…¶å®ç±»ä¼¼äºè¿™ç§ä¸‰æ–¹çš„æœåŠ¡ï¼ŒåŸºæœ¬ä¸Šéœ€è¦æ‰¾åˆ°ä¸‰æ–¹çš„å®˜ç½‘è¿›è¡Œæ¥å£çš„æŸ¥çœ‹å’Œç¡®è®¤ï¼ŒåŸºæœ¬ä¸Šéœ€è¦upload æˆ–è€… mvn ä¸‹æ¥ä¸‰æ–¹çš„sdkè¿›è¡Œclient çš„é…ç½®ï¼Œç„¶åå¯¹æ¥ä¸‰æ–¹çš„æœåŠ¡ï¼Œå…¶å®è¿™ä¸ªclient å°±å±äºä¸‰æ–¹æœåŠ¡çš„ç½‘å…³å±‚ï¼Œæˆ‘ä»¬æœåŠ¡å¯¹æ¥ä»–ä»¬çš„ç½‘å…³ï¼Œè¿›è¡ŒæœåŠ¡çš„è·å–<br>æ‰€ä»¥ä»£ç æˆ‘å°±ä¸è´´äº†ï¼Œå¦‚æœæœ‰éœ€æ±‚å¯ä»¥ç›´æ¥åˆ°æˆ‘çš„githubä¸Šcloneï¼Œ</p>
<p>####third. client-server begain</p>
<p>è¿™ä¸ªæœåŠ¡æ˜¯å±äºæˆ‘ä»¬è‡ªå·±çš„æœåŠ¡æ³¨å†Œå‘ç°å’Œå¯¹å¤–å®¢æˆ·ç«¯apiçš„æš´éœ²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç½‘å…³çš„ä½œç”¨<br>zoom keeperæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æˆ‘ä¸ºäº†ç®€å•ç›´æ¥å°±é‡‡ç”¨spring-cloudé›†åˆçš„æ’ä»¶eureka æ¥åšï¼Œä¸ç®¡ä»€ä¹ˆè€—å­ï¼Œèƒ½æŠ“åˆ°çš„çŒ«å°±å¯ä»¥æ‹¿æ¥å…»å˜›</p>
<p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘æ˜¯åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å®šä¹‰ä¸¤ä¸ªmodule ï¼Œåˆ†åˆ«ä¸€ä¸ªå®¢æˆ·ç«¯apiçš„consumerï¼Œæ¯ä¸€ä¸ªæœåŠ¡çš„ä¸Šçº¿éƒ½éœ€è¦åœ¨è¿™é‡Œè¿›è¡Œç»´æŠ¤æ›´æ–°apiï¼ŒåŒæ—¶æš´éœ²ç»™å¤–é¢æœåŠ¡çš„moduleï¼ˆclient moduleï¼‰ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯APIçš„æ³¨å†Œå‘ç°moduleï¼ˆserver moduelï¼‰ï¼Œè¿™ä¸ªæ¨¡å—å°±æ˜¯é›†ä¸­ç®¡ç†æ‰€æœ‰çš„æœåŠ¡çš„apiï¼Œè¿›è¡Œå¤–æ¥è¯·æ±‚çš„è½¬å‘</p>
<p>server module<br>è¦åšçš„äº‹æƒ…å¾ˆå°‘ï¼Œå°±æ˜¯å¼•å…¥springcloud eurekaçš„server çš„ä¾èµ–ï¼Œå¹¶åˆ¶å®šæœåŠ¡å™¨ç«¯å£ï¼Œè¿›è¡Œæ­¤æœåŠ¡çš„è·‘èµ·æ¥ç›‘å¬å…¶ä»–çš„æœåŠ¡çš„è®¾ç½®ï¼Œpom.xml bootstrap.yml ä»¥åŠserverApplicationçš„eurekaçš„æ³¨è§£å°±æå®š</p>
<p>bootstrap.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: amory-server</span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: 8071</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    prefer-ip-address: true</span><br><span class="line">  # ç”Ÿäº§ç¯å¢ƒä¸­å®˜æ–¹æ˜¯ä¸å»ºè®®ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œå› ä¸ºé‚£æ ·ä¼šç ´å eureka server çš„ä¿æŠ¤æ¨¡å¼</span><br><span class="line">  server:</span><br><span class="line">    # å…³é—­ä¿æŠ¤æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä¿®æ”¹ï¼‰</span><br><span class="line">    enable-self-preservation: false</span><br><span class="line">    # æ¸…ç†é—´éš”ï¼ˆé»˜è®¤æ˜¯60 * 1000 æ¯«ç§’ï¼‰ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä¿®æ”¹ï¼‰</span><br><span class="line">    eviction-interval-timer-in-ms: 60000</span><br><span class="line">    # Eureka æ‹‰å–æœåŠ¡åˆ—è¡¨æ—¶é—´ï¼ˆé»˜è®¤ï¼š30ç§’ï¼‰ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä¿®æ”¹ï¼‰</span><br><span class="line">    remote-region-registry-fetch-interval: 5</span><br><span class="line">  client:</span><br><span class="line">    # eureka server æ²¡å¿…è¦è‡ªå·±æŠŠè‡ªå·±æ³¨å†Œä¸Šå»ï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®æˆ false</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    # æ˜¯å¦ä»Eureka Serverä¸Šè·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ­¤å¤„å»ºè®®ä¿®æ”¹æˆ false ï¼ˆå•æœºè®¾ç½®çš„æ„ä¹‰ä¸å¤§ï¼Œå¦‚æœè®¾ç½®æˆ true å¯åŠ¨ä¼šå»æŠ“å–ä¸€æ¬¡æ³¨å†Œè¡¨ï¼Œè·å–ä¸åˆ°æ›´æ–°ç¼“å­˜å°±ä¼šå‡ºé”™ï¼ˆè¯¥é”™è¯¯ä¸å½±å“ eureka æ­£å¸¸ä½¿ç”¨ï¼‰ï¼‰</span><br><span class="line">    fetch-registry: false</span><br><span class="line">    service-url:</span><br><span class="line">      # é»˜è®¤æ³¨å†Œåœ°å€ this.serviceUrl.put(&quot;defaultZone&quot;, &quot;http://localhost:8761/eureka/&quot;);</span><br><span class="line">      # åˆ’é‡ç‚¹ï¼šæ­¤å¤„çš„ defaultZone åƒä¸‡åˆ«å†™æˆ default-zone</span><br><span class="line">      defaultZone: http://localhost:8071/eureka</span><br><span class="line">      # ä» Eureka æœåŠ¡å™¨ç«¯è·å–æ³¨å†Œä¿¡æ¯çš„é—´éš”æ—¶é—´ï¼ˆé»˜è®¤ï¼š30ç§’ï¼‰</span><br><span class="line">    registry-fetch-interval-seconds: 5</span><br></pre></td></tr></table></figure>

<p>pom.xml çš„ä¾èµ–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>serverApplicationçš„æ³¨å†Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@EnableEurekaServer</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class ServerApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>client ç«¯ä½œä¸ºè‡ªå®šä¹‰çš„ç½‘å…³å±‚ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªæš´éœ²çš„apiåŒ…ï¼Œcontroller åŒ…ç”¨æ¥è½¬å‘åˆ°å†…éƒ¨æœåŠ¡apiï¼Œä»¥åŠå¯ä»¥æœ‰ä¸€äº›å…¬ç”¨æ¨¡å—çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æƒé™è®¤è¯ç­‰éœ€æ±‚</p>
<p>é‚£ä¹ˆå®ƒä½œä¸ºä¸€ä¸ªconsumeræ¨¡å—ï¼Œæ˜¯éœ€è¦è¢«provider server ä¹Ÿå°±æ˜¯ä¸Šé¢çš„serverapplicationè¿›è¡Œç›‘å¬çš„<br>ï¼Œæ‰€ä»¥ä»–ä¹Ÿè¦æœ‰ç›¸åº”çš„é…ç½®</p>
<p>bootstrap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8072</span><br><span class="line"># å¦‚æœä¸å†™ Eureka Server ä¸­çš„ç•Œé¢ä¸­ Application å°±ä¼šæ˜¯ Unknown å°½é‡å†™</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: amory-client-gateway</span><br><span class="line">  cloud:</span><br><span class="line">    inetutils:</span><br><span class="line">      # å¿½ç•¥æŒ‡å®šç½‘å¡ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰ï¼Œå‡è®¾ä½ çš„ç”µè„‘æœ‰ VM é‚£ä¹ˆè¯¥é€‰é¡¹æ˜¯éå¸¸æœ‰ç”¨çš„ä¸€ä¸ªé€‰é¡¹</span><br><span class="line">      ignored-interfaces:             #å¿½ç•¥ docker0 ç½‘å¡ä»¥åŠ veth å¼€å¤´çš„ç½‘å¡</span><br><span class="line">        - docker0</span><br><span class="line">        - veth.*</span><br><span class="line">      preferred-networks:             # ä½¿ç”¨æŒ‡å®šç½‘ç»œåœ°å€ï¼Œé€‰æ‹© eth0 ç½‘å¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å†™ IP ï¼ˆ192.168ï¼‰</span><br><span class="line">        - eth0</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    # æ­¤å¤„å»ºè®®å†™ï¼Œä¸å†™é»˜è®¤æ˜¯æœºå™¨å</span><br><span class="line">    prefer-ip-address: true</span><br><span class="line">    # ä¼˜å…ˆçº§å°äº application.properties ï¼Œå¦‚æœä½ æƒ³çŸ¥é“å½“å‰æ³¨å†Œä¸Šå»çš„ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨ application.properties ä¸­çš„é…ç½®å†™æ³•</span><br><span class="line">    # å› ä¸º bootstrap.yml æœ€æ—©åˆå§‹åŒ–ï¼Œé‚£æ—¶å€™è¿˜æ— æ³•è¯»å–åˆ° pom.xml ä¸­çš„å±æ€§</span><br><span class="line">    instance-id: $&#123;spring.cloud.client.ip-address&#125;:$&#123;spring.application.instance_id:$&#123;server.port&#125;&#125;</span><br><span class="line">    # ip-address å¼ºè¡ŒæŒ‡å®šæ­¤å®ä¾‹ IP ï¼Œä¸æ˜¯å¾ˆæ¨èï¼Œç»å¤§å¤šæ•°æƒ…å†µ prefer-ip-address ä¸  preferred-networks é…åˆéƒ½å¤Ÿç”¨äº†</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      # åˆ’é‡ç‚¹ï¼šæ­¤å¤„çš„ defaultZone åƒä¸‡åˆ«å†™æˆ default-zone</span><br><span class="line">      defaultZone: http://localhost:8071/eureka/</span><br></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>å…¥å£æŒ‡å®šæ¶ˆè´¹è€…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">public class ClientGateWayApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ClientGateWayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹ä¸€ä¸‹client consumerçš„æ•´ä½“ç»“æ„å›¾<br><img src="https://github.com/amorynan/study/blob/master/pic/jiagou.jpg?raw=true" alt></p>
<p>apis åŒ…é‡Œé¢å®šä¹‰å„ç§å¯ä»¥æš´éœ²çš„api ï¼Œç„¶åé€šè¿‡controller åŒ…é‡Œé¢çš„mappingï¼Œè°ƒç”¨interfaceåŒ…é‡Œé¢çš„client æœåŠ¡ï¼Œå¯ä»¥ç®€å•å°±ç†è§£interfacesåŒ…é‡Œé¢å°±æ˜¯è‡ªå·±å…¬å¸å†…éƒ¨å„ä¸ªä¸Šçº¿æœåŠ¡çš„service æ¥å£<br>æ‰€ä»¥ï¼Œç®€å•çœ‹ä¸‹mini æœåŠ¡çš„ç½‘å…³æœåŠ¡å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * mini pro plugin å®¢æˆ·æ®µ</span><br><span class="line"> * @Author: amory</span><br><span class="line"> * @Date: 2019-07-10</span><br><span class="line"> */</span><br><span class="line">@FeignClient (name = ClientGateWayApis.MINIPROPLUGIN_NAME, decode404 = true)</span><br><span class="line">public interface MiniProPluginClient &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å¾®ä¿¡å°ç¨‹åºç«¯ç”¨æˆ·ç™»é™†api</span><br><span class="line">     * è¿”å›ç»™å°ç¨‹åºç«¯ è‡ªå®šä¹‰ç™»é™†æ€ token</span><br><span class="line">     */</span><br><span class="line">    @GetMapping (ClientGateWayApis.LOGIN)</span><br><span class="line">    CommonResult wxMemberLogin(@RequestBody Map&lt;String, String&gt; request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@FeignClient å°±æ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼ï¼Œå°†æ³¨å†Œåˆ°spring-cloud erukaçš„clientæœåŠ¡é€šè¿‡å®šä¹‰çš„springï¼šapplicationï¼šname å”¯ä¸€è¯†åˆ«åˆ°ï¼Œå…¶å®è½¬æ¢æˆçš„å«ä¹‰å°±æ˜¯å”¯ä¸€å®šä½åˆ° ip+portçš„æ–¹å¼ï¼Œé€šè¿‡httpè¿›è¡Œè½¬å‘<br>ï¼Œç„¶ååœ¨é€šè¿‡æ­¤ç½‘å…³ï¼Œç»™ç½‘å…³å±‚çš„controller ç»™å¤–éƒ¨æœåŠ¡ç”¨ï¼Œæ•´ä½“æ¶æ„å°±æ˜¯è¿™ä¹ˆå›äº‹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹æºç å•¥çš„ï¼Œæœ‰åŠ©ç†è§£<br>åœ¨è¿™é‡Œä¹Ÿpoå‡ºä¸€ä¸ªæ¶æ„å›¾ï¼š<br><img src="https://github.com/amorynan/study/blob/master/pic/%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%9B%BE.png?raw=true" alt></p>
<p>ğŸ‘‡æœ‰æºç å“¦ï¼Œä½ è¦ä¸è¦æˆ³ä¸€æˆ³ğŸ‘€</p>
<p><a href="ä¸‰æ–¹ç½‘å…³">https://github.com/amorynan/thirdGateway</a></p>
<p><a href="è‡ªå·±æœåŠ¡ç½‘å…³">https://github.com/amorynan/clientGateway</a></p>
</div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/gateway/">gateway</a><a class="post-meta__tags" href="/tags/eureka/">eureka</a></div></article><nav id="pagination"><div class="next-post pull-right"><a href="/2019/07/05/netstat å‘½ä»¤ä¸‹çœ‹ä½ åˆ°åº•äº†è§£å¤šå°‘ç½‘ç»œçŸ¥è¯†ä¸‹/"><span>netstat ä¸‹æŸ¥çœ‹ä½ æŒæ¡å¤šå°‘ç½‘ç»œçŸ¥è¯†?ä¸­</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment_title" class="gitment_title"></div>
<div id="container" style="display:none"></div>
<link rel="stylesheet" href="https://www.wenjunjiang.win/css/gitment.css">
<script src="https://www.wenjunjiang.win/js/gitment.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
  const myTheme = {
    render(state, instance) {
      const container = document.createElement('div');
      container.lang = "en-US";
      container.className = 'gitment-container gitment-root-container';
      container.appendChild(instance.renderHeader(state, instance));
      container.appendChild(instance.renderEditor(state, instance));
      container.appendChild(instance.renderComments(state, instance));
      container.appendChild(instance.renderFooter(state, instance));
      return container;
    }
  }

  function showGitment() {
    $("#gitment_title").attr("style", "display:none");
    $("#container").attr("style", "").addClass("gitment_container");
    var gitment = new Gitment({
      id: decodeURI(window.location.pathname),
      theme: myTheme,
      owner: 'amorynan',
      repo: 'https://amorynan.github.io/',
      oauth: {
        client_id: 'dd00b7cc5fbce0060c2d',
        client_secret: '9e044107808ba825bdf0990c19c4501de74bdcec'
      }
    });
    gitment.render('container');
  }

  showGitment();
</script>
</div></div><footer><div class="layout" id="footer"><div class="copyright">Â©2013 - 2019 By amory wang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span> |  </span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/fancybox.js"></script><script src="/js/sidebar.js"></script><script src="/js/copy.js"></script><script src="/js/fireworks.js"></script><script src="/js/transition.js"></script><script src="/js/scroll.js"></script><script src="/js/head.js"></script></body></html>